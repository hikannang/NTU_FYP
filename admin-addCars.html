<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Car</title>
  <link rel="stylesheet" href="static/CSS/admin.css">
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIzCVkjYrehQ5o4VeoD5_lwc-0-36mXqc&libraries=places"></script>
</head>
<body>
  <div class="container">
    <h1>Add a New Car</h1>
    <form id="add-car-form">
      

      <!-- Car Location Address -->
      <label for="car-address">Car Location Address:</label>
      <input type="text" id="car-address" name="car-address" placeholder="Enter address or postal code" required autocomplete="off">
      <span id="geocoding-status" class="status-message"></span>

      <!-- Latitude and Longitude -->
      <label for="car-latitude">Latitude:</label>
      <input type="number" id="car-latitude" name="car-latitude" step="any" placeholder="Optional">
      <label for="car-longitude">Longitude:</label>
      <input type="number" id="car-longitude" name="car-longitude" step="any" placeholder="Optional">
      <button type="button" id="use-current-location">Use Current Location</button>

      <!-- Car Type -->
      <label for="car-type">Car Type:</label>
      <select id="car-type" name="car-type" required>
        <option value="Petrol">Petrol</option>
        <option value="Electric">Electric</option>
      </select>

      <!-- Number of Seats -->
      <label for="car-seats">Number of Seats:</label>
      <select id="car-seats" name="car-seats" required>
        <option value="5">5</option>
        <option value="7">7</option>
      </select>

      <!-- License Plate -->
      <label for="car-plate">License Plate:</label>
      <input type="text" id="car-plate" name="car-plate" placeholder="e.g., SMB123A" required>
      <span id="car-plate-error" class="error-message"></span>

      <!-- Status -->
      <label for="car-status">Status:</label>
      <select id="car-status" name="car-status" required>
        <option value="available">Available</option>
        <option value="maintenance">Maintenance</option>
        <option value="unavailable">Unavailable</option>
      </select>

      <!-- Service Due Date -->
      <label for="service-due">Service Due Date:</label>
      <input type="date" id="service-due" name="service-due" required>

      <!-- Insurance Expiry Date -->
      <label for="insurance-expiry">Insurance Expiry Date:</label>
      <input type="date" id="insurance-expiry" name="insurance-expiry" required>

      <!-- Submit Button -->
      <button type="submit">Add Car</button>
    </form>
  </div>

  <script>
    // Initialize Google Places Autocomplete for the address input
    const addressInput = document.getElementById('car-address');
    const autocomplete = new google.maps.places.Autocomplete(addressInput, { componentRestrictions: { country: 'SG' } });

    // Use Current Location Button
    document.getElementById('use-current-location').addEventListener('click', async () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (position) => {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;

          // Populate latitude and longitude fields
          document.getElementById('car-latitude').value = latitude;
          document.getElementById('car-longitude').value = longitude;

          // Reverse geocode to get the address
          const apiUrl = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=AIzaSyCIzCVkjYrehQ5o4VeoD5_lwc-0-36mXqc`;
          try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            if (data.status === 'OK') {
              document.getElementById('car-address').value = data.results[0].formatted_address;
            } else {
              alert('Failed to retrieve address from coordinates.');
            }
          } catch (error) {
            console.error('Error reverse geocoding:', error);
            alert('Error retrieving address from coordinates.');
          }
        }, (error) => {
          alert('Error retrieving current location: ' + error.message);
        });
      } else {
        alert('Geolocation is not supported by this browser.');
      }
    });
  </script>
  <script src="static/Javascript/admin-addCars.js"></script>
</body>
</html>