<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Booking | BaoCarLiao Admin</title>
  <link rel="stylesheet" href="../static/css/admin/admin.css">
  <link rel="stylesheet" href="../static/css/admin/admin-booking-edit.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="admin-body">
  <!-- Admin header will be loaded here -->
  <div id="header"></div>

  <main class="admin-main">
    <div class="container">
      <!-- Page Header -->
      <div class="page-header-wrapper">
        <div class="page-header">
          <div class="breadcrumb">
            <a href="admin-dashboard.html"><i class="bi bi-house"></i> Dashboard</a>
            <i class="bi bi-chevron-right"></i>
            <a href="admin-bookings.html">Bookings</a>
            <i class="bi bi-chevron-right"></i>
            <span class="current">Edit Booking</span>
          </div>
          <h1 class="page-title">
            <i class="bi bi-calendar-check"></i> Edit Booking
          </h1>
        </div>
        <div class="header-actions">
          <button id="cancel-btn" class="secondary-btn">
            <i class="bi bi-x"></i> Cancel
          </button>
          <button id="save-btn" class="primary-btn" disabled>
            <i class="bi bi-check-lg"></i> Save Changes
            <span id="unsaved-indicator"></span>
          </button>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="edit-container">
        <!-- Info Summary Section -->
        <div class="info-summary-container">
          <!-- Customer Info Card -->
          <div class="detail-section">
            <div class="detail-section-header">
              <i class="bi bi-person-circle"></i>
              <h3>Customer Information</h3>
            </div>
            <div class="detail-section-body">
              <div class="detail-row">
                <strong id="customer-name">Loading...</strong>
              </div>
              <div class="detail-row">
                <i class="bi bi-envelope"></i>
                <span id="customer-email">Loading...</span>
              </div>
              <div class="detail-row">
                <i class="bi bi-telephone"></i>
                <span id="customer-phone">Loading...</span>
              </div>
            </div>
          </div>

          <!-- Vehicle Info Card -->
          <div class="detail-section">
            <div class="detail-section-header">
              <i class="bi bi-car-front"></i>
              <h3>Vehicle Information</h3>
            </div>
            <div class="detail-section-body">
              <div class="detail-row">
                <strong id="car-name">Loading...</strong>
              </div>
              <div class="detail-row">
                <i class="bi bi-tag"></i>
                <span id="car-license">Loading...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Form Section -->
        <div class="edit-form-container">
          <form id="booking-edit-form" class="edit-form">
            <div class="edit-card">
              <div class="edit-card-header">
                <h3><i class="bi bi-pencil-square"></i> Booking Details</h3>
              </div>
              <div class="edit-card-body">
                <!-- Status -->
                <div class="form-group">
                  <label for="booking-status">Status</label>
                  <select id="booking-status" class="form-control">
                    <option value="upcoming">Upcoming</option>
                    <option value="active">Active</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                  </select>
                </div>

                <!-- Start Date and Time -->
                <div class="form-row">
                  <div class="form-group">
                    <label for="start-date">Start Date</label>
                    <input type="date" id="start-date" class="form-control">
                  </div>
                  <div class="form-group">
                    <label for="start-time">Start Time</label>
                    <input type="time" id="start-time" class="form-control">
                  </div>
                </div>

                <!-- End Date and Time -->
                <div class="form-row">
                  <div class="form-group">
                    <label for="end-date">End Date</label>
                    <input type="date" id="end-date" class="form-control">
                  </div>
                  <div class="form-group">
                    <label for="end-time">End Time</label>
                    <input type="time" id="end-time" class="form-control">
                  </div>
                </div>

                <!-- Price -->
                <div class="form-group">
                  <label for="total-price">Total Price ($)</label>
                  <input type="number" id="total-price" class="form-control" step="0.01" min="0">
                </div>

                <!-- Notes -->
                <div class="form-group">
                  <label for="booking-notes">Notes</label>
                  <textarea id="booking-notes" class="form-control" rows="4" placeholder="Add any notes or special instructions"></textarea>
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
              <div class="action-hint">
                <i class="bi bi-info-circle"></i>
                <span>All changes will be synchronized across user bookings and timesheet entries.</span>
              </div>
              <div class="action-buttons">
                <button type="button" id="cancel-btn-bottom" class="secondary-btn">Cancel</button>
                <button type="submit" id="save-btn-bottom" class="primary-btn" disabled>
                  <i class="bi bi-check-lg"></i> Save Changes
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Additional Actions -->
      <div class="additional-actions">
        <div class="edit-card">
          <div class="edit-card-header">
            <h3><i class="bi bi-gear"></i> Additional Actions</h3>
          </div>
          <div class="edit-card-body">
            <div class="action-grid">
              <button id="send-receipt-btn" class="action-btn">
                <i class="bi bi-envelope"></i>
                <span>Email Receipt</span>
              </button>
              <button id="update-status-btn" class="action-btn">
                <i class="bi bi-arrow-repeat"></i>
                <span>Change Status</span>
              </button>
              <button id="delete-booking-btn" class="action-btn danger">
                <i class="bi bi-trash"></i>
                <span>Delete Booking</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer will be loaded here -->
  <div id="footer"></div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="bi bi-exclamation-triangle"></i> Delete Booking</h2>
        <button class="close-modal"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this booking? This action cannot be undone.</p>
        <div class="warning-info">
          <p><strong>This will permanently remove:</strong></p>
          <ul>
            <li>The booking entry from the main database</li>
            <li>The booking from the customer's booking history</li>
            <li>The timeslot from the vehicle's schedule</li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button class="secondary-btn close-modal">Cancel</button>
        <button id="confirm-delete" class="danger-btn">Delete Booking</button>
      </div>
    </div>
  </div>

  <!-- Status Update Modal -->
  <div id="status-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="bi bi-arrow-repeat"></i> Update Status</h2>
        <button class="close-modal"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <p>Select a new status for this booking:</p>
        <div class="status-options">
          <button class="status-option status-upcoming" data-status="upcoming">
            <i class="bi bi-calendar"></i>
            <span>Upcoming</span>
          </button>
          <button class="status-option status-active" data-status="active">
            <i class="bi bi-play-circle"></i>
            <span>Active</span>
          </button>
          <button class="status-option status-completed" data-status="completed">
            <i class="bi bi-check-circle"></i>
            <span>Completed</span>
          </button>
          <button class="status-option status-cancelled" data-status="cancelled">
            <i class="bi bi-x-circle"></i>
            <span>Cancelled</span>
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="secondary-btn close-modal">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Scripts -->
  <script src="../static/js/common/firebase-config.js" type="module"></script>
  <script src="../static/js/admin/admin-booking-edit.js" type="module"></script>
</body>
</html>