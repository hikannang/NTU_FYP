<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Booking | Admin Dashboard</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="../static/css/admin/admin.css">
  <link rel="stylesheet" href="../static/css/admin/admin-booking-edit.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
</head>
<body class="admin-body">
  <div id="header"></div>
  
  <div class="admin-content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-left">
        <button id="back-btn" class="back-button">
          <i class="bi bi-arrow-left"></i>
        </button>
        <div class="title-container">
          <h1 class="page-title">Edit Booking</h1>
          <p class="breadcrumbs">
            <a href="admin-dashboard.html">Dashboard</a> / 
            <a href="admin-bookings.html">Bookings</a> / 
            <span>Edit</span>
          </p>
        </div>
      </div>
      <div class="header-actions">
        <button id="cancel-btn" class="secondary-btn">
          <i class="bi bi-x"></i> Cancel
        </button>
        <button id="save-btn" class="primary-btn" disabled>
          <i class="bi bi-check-lg"></i> Save Changes
          <span id="unsaved-indicator"></span>
        </button>
      </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="edit-container">
      <!-- Customer & Car Info Summary -->
      <div class="info-summary-container">
        <div class="info-card customer-info">
          <div class="info-header">
            <i class="bi bi-person-circle"></i>
            <h3>Customer</h3>
          </div>
          <div class="info-body">
            <div class="info-row">
              <strong id="customer-name">Loading...</strong>
            </div>
            <div class="info-row">
              <i class="bi bi-envelope"></i>
              <span id="customer-email">Loading...</span>
            </div>
            <div class="info-row">
              <i class="bi bi-telephone"></i>
              <span id="customer-phone">Loading...</span>
            </div>
          </div>
        </div>

        <div class="info-card car-info">
          <div class="info-header">
            <i class="bi bi-car-front"></i>
            <h3>Vehicle</h3>
          </div>
          <div class="info-body">
            <div class="info-row">
              <strong id="car-name">Loading...</strong>
            </div>
            <div class="info-row">
              <i class="bi bi-tag"></i>
              <span id="car-license">Loading...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Booking Edit Form -->
      <div class="edit-form-container">
        <form id="booking-edit-form">
          <div class="form-card">
            <div class="card-header">
              <h3><i class="bi bi-calendar-check"></i> Booking Details</h3>
            </div>
            <div class="card-body">
              <!-- Status -->
              <div class="form-section">
                <label for="booking-status">Status</label>
                <select id="booking-status" class="form-control" required>
                  <option value="upcoming">Upcoming</option>
                  <option value="active">Active</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>

              <!-- Start Date and Time -->
              <div class="form-row">
                <div class="form-section">
                  <label for="start-date">Start Date</label>
                  <input type="date" id="start-date" class="form-control" required>
                </div>
                <div class="form-section">
                  <label for="start-time">Start Time</label>
                  <input type="time" id="start-time" class="form-control" required>
                </div>
              </div>

              <!-- End Date and Time -->
              <div class="form-row">
                <div class="form-section">
                  <label for="end-date">End Date</label>
                  <input type="date" id="end-date" class="form-control" required>
                </div>
                <div class="form-section">
                  <label for="end-time">End Time</label>
                  <input type="time" id="end-time" class="form-control" required>
                </div>
              </div>

              <!-- Price -->
              <div class="form-section">
                <label for="total-price">Total Price ($)</label>
                <input type="number" id="total-price" class="form-control" step="0.01" min="0" required>
              </div>

              <!-- Notes -->
              <div class="form-section">
                <label for="booking-notes">Notes</label>
                <textarea id="booking-notes" class="form-control" rows="4" placeholder="Add any additional notes about this booking"></textarea>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <div class="action-hint">
              <i class="bi bi-info-circle"></i>
              <span>All changes will be synchronized across user bookings and timesheet entries.</span>
            </div>
            <div class="action-buttons">
              <button type="button" id="cancel-btn-bottom" class="secondary-btn">Cancel</button>
              <button type="submit" id="save-btn-bottom" class="primary-btn" disabled>
                <i class="bi bi-check-lg"></i> Save Changes
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Additional Actions Section -->
    <div class="additional-actions">
      <div class="actions-card">
        <div class="card-header">
          <h3><i class="bi bi-gear"></i> Booking Actions</h3>
        </div>
        <div class="card-body">
          <div class="action-grid">
            <button id="send-receipt-btn" class="action-btn">
              <i class="bi bi-envelope"></i>
              <span>Send Receipt</span>
            </button>
            <button id="update-status-btn" class="action-btn">
              <i class="bi bi-arrow-clockwise"></i>
              <span>Update Status</span>
            </button>
            <button id="delete-booking-btn" class="action-btn danger">
              <i class="bi bi-trash"></i>
              <span>Delete Booking</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="bi bi-exclamation-triangle"></i> Delete Booking</h2>
        <button class="close-modal">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this booking? This action cannot be undone.</p>
        <p><strong>This will permanently remove:</strong></p>
        <ul>
          <li>The booking entry from the main database</li>
          <li>The booking from the customer's booking history</li>
          <li>The timeslot from the vehicle's schedule</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="secondary-btn close-modal">Cancel</button>
        <button id="confirm-delete" class="danger-btn">Delete Booking</button>
      </div>
    </div>
  </div>

  <!-- Status Update Modal -->
  <div id="status-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="bi bi-arrow-repeat"></i> Update Status</h2>
        <button class="close-modal">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Select a new status for this booking:</p>
        <div class="status-options">
          <button class="status-option status-upcoming" data-status="upcoming">
            <i class="bi bi-calendar"></i> Upcoming
          </button>
          <button class="status-option status-active" data-status="active">
            <i class="bi bi-play-circle"></i> Active
          </button>
          <button class="status-option status-completed" data-status="completed">
            <i class="bi bi-check-circle"></i> Completed
          </button>
          <button class="status-option status-cancelled" data-status="cancelled">
            <i class="bi bi-x-circle"></i> Cancelled
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="secondary-btn close-modal">Cancel</button>
      </div>
    </div>
  </div>

  <div id="footer"></div>

  <!-- Scripts -->
  <script src="../static/js/common/firebase-config.js" type="module"></script>
  <script src="../static/js/admin/admin-booking-edit.js" type="module"></script>
</body>
</html>